// import 'dotenv/config';

// const PORT = 5000
// const MONGO_URI = "mongodb+srv://meshouryanarwade:Shourya%402007@cluster0.b6z4nz9.mongodb.net/bsuite"
// const JWT_ACCESS_SECRET = "aksjdhaksjSHouryaakjdhsadkjahsdkjhasd"
// const JWT_REFRESH_SECRET = "aksjdhaksjReplavascekjdhsadkjahsdkjhasd"
// const ACCESS_TOKEN_TTL = "30m"
// const REFRESH_TOKEN_TTL = "30d"
// const CORS_ORIGINS = "http://localhost:3000"
// const COOKIE_SECURE = false
// const NODE_ENV = 'development'
// const APP_URL = "http://localhost:5000"
// const FB_APP_ID = "737215622456564"
// const FB_APP_SECRET = "1ddcb93a22b50b47aec8378434205606"
// const FB_REDIRECT_URI = "http://localhost:5000/api/wa/embedded_signup/callback"
// const FB_APP_ACCESS_TOKEN = "YOUR_LONG_LIVED_APP_OR_SYSTEM_USER_TOKEN"
// const WA_WEBHOOK_VERIFY_TOKEN = "aksjdhaksjwebhokasdokasdokavascekjdhsadkjahsdkjhasd"
// const SMTP_HOST  = "smtp.hostinger.com"
// const SMTP_PORT  = "465"
// const SMTP_USER = "accountservices@magneticbyte.com"
// const SMTP_PASS = "vZ6!yC0y5#4"
// const MAIL_FROM = "accountservices@magneticbyte.com"
// const DC_PRIVATE_KEY_PEM= "-----BEGIN PRIVATE KEY-----MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCmZVX6u1d3G1nb3zcL4BQ8SSdJeVnwEOjZS+LBKlvT8WebmbM9tjw3NHAINKOgvu6WLHbiGWAdwKRAw/o2yiuIRRO9shiQTtYjVNdNIyWauJzi0hgCmbewofoKADnoQbSI71wFh7gZS/fqkdAHElZPjG6eSobpKUKRSOY1tHbX06hDvmWaWFYwILjj0NP4N4L3OsH1dmABk5ZcDd5Bh5maN8qRlV6jrft5eKyIus6eIYWvXhX3yMHU7w99hR13J8mBC7pVOUDJQwew1QlssszmXEzOV/HEMEqEmJW/amSRCRaGm/e+1e3lUWAZ/WZxFl0ExrZShVCiIuTfSAs09g1xAgMBAAECggEAAWw+HUhlG8IPN//8ph3Iwdh2Cm+Rb99Oz2ix8AkJFfA4sfoGgDzG1GnEJWTRAJ9mAMDxSgxcSprWk2LISM1HIfmFvQEJAIcPtz0AVjhKh+F5NB+75/NJVgxs2/v9zW/Y5RTHY0PNJKMQ4/0H079R1L5YmzgbzIJPX6N0APyZtCLHZ50DCPRqkzpn2SIx0+FGqyf+QsQjyJcuPalzCRdnwQXIjw2uKt040xTMDzc+1/Rvg9OIB5zUN0JxDesSE4fgoC40cpOyOfFFZAC50sX/lOZave9Niyw/1CLvbUv3uRxdZlCqke+kwmwYoAteCQw4+WrxWIeP3EKNWV2nZP8GgQKBgQDqJP24qzw4XghLEXbdn4AJIlC5FEZmIVPFA3U0J6HbAkp7oYn+IQaJUBD0Hda3ikRE9TOhlnT6jjhonu2/ZC2LZG93rG3rOyvTM7ngZW+ZM+CDZIoT6MVubwjY7p7/UqcdJKGsc4Z0BTfxhXJUYqDHJFZAG3TZCT1FZMumt+bT8QKBgQC17XRFcQVu40hU6DYtPrw7NjDGZgZQ7Z480+reVNDxtGAfkc0+ZlzcKtCyN01l6UfxkXWLJVk5c0bTUjlNmfD8tmN/xeYBWeZwikM4j4E+TsOiEh8wwKBRBAPfxUKnjSm7oTx2NR+rB5NVaPLsLeGQ019G+bY1uagaMO1RR/ZRgQKBgQCtwx33+jwKqN4Gt8M63a+rF6hIcd9806bTQqmsNu1LFvwnm85IpkGvjZfHUo2SUC4x7raOaJYPi5QZMDjIHJQgKjz+1xwLwjHX3z9GZIDZdUJcwDQoakp6ljQ+qXedi70xR4oj7OgPGgBWYO5j6X3fy/umP7oLh2vNH+xyoW/QQQKBgQCbLmcFbLizs49ZTZIY2fB5mWnVceVlVqqpPCKVb0ejRLbRdu7ZkTsYWjUWL3IHwgsqFWdsP3lyNdBuJS7X8L3M8k7BCK9+645S5L0eG9qkqU7aihas4UJemMwtLfgDL7gvYgNO2VWf76BPNGwx5ZkIjiQxSIOSJEEtxhpIQNftAQKBgEmsVibMF5PeNJpdk+ABuMcab8gS45rKQCLX/jd9kF/2zjfXYwcwJ4HFHDU1B8Vtemn2k4g3PM1g74+syUYN0t/MRRx6/nUhQXeZ9TrfOQqe/7+xZyYmP12bwYVyM0uc1Y7zRWNcvK2iTFvsamW8r+sDB0HvBpS11OGgNLbX5dxe-----END PRIVATE KEY-----"
// const DC_KEY_HOST= "key1"
// const DC_PROVIDER_ID= "magneticbyteinternettechnologiesopcpvtltd.in"
// const DC_SERVICE_ID= "email-auth"
// const DC_REDIRECT_URI= "http://localhost:5000/api/domainconnect/callback"
// const DKIM_SELECTOR1= "k1"
// const DKIM_SELECTOR2= "k2"
// const SVC_DOMAIN= "your-svc.net"
// const DMARC_RUA= "mailto:dmarc@yourco.example"

// export const env = {
//     port: PORT || 5000,
//     mongoUri: MONGO_URI,
//     accessSecret: JWT_ACCESS_SECRET,
//     refreshSecret: JWT_REFRESH_SECRET,
//     accessTtl: ACCESS_TOKEN_TTL || '30m',
//     refreshTtl: REFRESH_TOKEN_TTL || '30d',
//     corsOrigins: (CORS_ORIGINS || '').split(',').map(s => s.trim()).filter(Boolean),
//     cookieSecure: (COOKIE_SECURE || 'false') === 'true',
//     nodeEnv: NODE_ENV || 'development',
//     APP_URL: APP_URL,
//     FB_APP_ID: FB_APP_ID,
//     FB_APP_SECRET: FB_APP_SECRET,
//     FB_REDIRECT_URI: FB_REDIRECT_URI,
//     FB_APP_ACCESS_TOKEN: FB_APP_ACCESS_TOKEN,
//     WA_WEBHOOK_VERIFY_TOKEN: WA_WEBHOOK_VERIFY_TOKEN,
//     jwtSecret: "sadkjaskdjjwtSecretasdasdasdafad",
//     corsOrigins: "http://localhost:3000",
//     SMTP_HOST: SMTP_HOST,
//     SMTP_PORT: SMTP_PORT,
//     SMTP_USER: SMTP_USER,
//     SMTP_PASS: SMTP_PASS,
//     MAIL_FROM: MAIL_FROM,
//     DC_PRIVATE_KEY_PEM: DC_PRIVATE_KEY_PEM,   // your RSA private key (PEM)
//     DC_KEY_HOST: DC_KEY_HOST,       // matches TXT host "key1.keys..."
//     DC_PROVIDER_ID: DC_PROVIDER_ID,
//     DC_SERVICE_ID: DC_SERVICE_ID,
//     DC_REDIRECT_URI: DC_REDIRECT_URI,
//     DKIM_SELECTOR1: DKIM_SELECTOR1,
//     DKIM_SELECTOR2: DKIM_SELECTOR2,
//     SVC_DOMAIN: SVC_DOMAIN,
//     DMARC_RUA: DMARC_RUA,
// };


// src/config/env.js  (ESM)
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

// Put your key files here: <repo>/keys/private.pem and /keys/public.pem
const KEYS_DIR = path.resolve(__dirname, '../../keys');

function readTextSafe(filePath) {
    try { return fs.readFileSync(filePath, 'utf8').trim(); } catch { return ''; }
}

// Try files first. If missing, fall back to the inline literals below.
const PRIVATE_PEM_FILE = path.join(KEYS_DIR, 'private.pem');
const PUBLIC_PEM_FILE = path.join(KEYS_DIR, 'public.pem');

const PRIVATE_PEM_FROM_FILE = readTextSafe(PRIVATE_PEM_FILE);
const PUBLIC_PEM_FROM_FILE = readTextSafe(PUBLIC_PEM_FILE);

// ↓↓↓ If you don’t want files, paste the FULL blocks here including BEGIN/END lines ↓↓↓
const PRIVATE_PEM_INLINE = `
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDEtDksrjgTlbKX
X+seKXB8miO8Yt5i7AkJAhXanoM8m4iTmfleEdyPQsIRNoBxvKluDRPa4VYK+6A0
roWbaQE1VeJ/cNQK5ontPG8M9jiUBGFZidFiuXOVLONJB6h2paxlzPq9TpzCwM81
XuhzCG8RQyYTT4KRPW4UD9c2KhrbjSks8sx7SvCHFFcFh2Lfyr7J4GGtKvSV9t2D
qfQWhn/zczPMBgtlNcnnqQkXusovTpHQJFIp7Rl9+m3FLKQjS20vbJj5S+cjuYDh
Rvr1ybTBHSfFsJTxJbJRZafL4R10fj4WgFMyCE5c89K+Lu61JfbAd1LI5COGTqcO
HnSquT4tAgMBAAECggEAHCt5Mqpikn9yO5Z7e+7QUq/aZUy9b2pBIv6e9ZeU0NWv
WgAHg87ICOY1F7T38RHlK8MIsGRr55fAijriHG8Nwr8heEHGxCbe4tAwUSlj0eLM
tD918o7/fAIZLKjBmfhA97VCxWCgN43YPtrwLCUtjsnQhpxw5O7ouEvKdNHT1dQh
WgL29YSEdcZy62/t9fjBIOML3P8yGzhsVVl/D5oNaFKIcco4SaNfw2Bo6z365Ybo
9mfozbxOwnNtAV61sT8reVMjkmzK4SRP+XT3bPn1wysl7+s0d9YBdbPZmIFIOz9V
9LIoTT8hFU1qHp8RWMoZLxqp99DRtoZatTSMS5/OgQKBgQD3Kb2HSkExh4YwyiGi
MAA6HlzYpLgaHGVxJJbZUR6qfkFVXyjzz/Y44n8Ixtw4bmX2w9plxS3OnGvHUXiE
TZhs9q5TxpIpAxMHpMeESLn1TDo05VigtgDqveANP2XTYNCiYDZbCURlnuOqfN/h
vRDaV44V7lk8ZzWfNAOYUytvQQKBgQDLvKLaVn0jaEVRGXvV4gcff76YSvW4rpsM
4kcDcoYmpgjIou8emMovuCwpYD4EseX8yInTXR7awWvAaSfQdmL3etSHyoHYemIr
x0fIV59ILLPlAS4dlJwsOC3qnytINShi2qiXHQnWC+jCT0Tgpjb2G84++1WTxRkw
H5/w3NJ/7QKBgEXbU0kYsKJqFoBVsPnhLT8/86f7rlka64T1/XjAl7VCZ/7UHYQD
pCjhw1vcsMN2WHVNV73p5A+AYGn+Wdyy/cDWW+Erv4W967P+W7HEyGJPQChRJiKO
LmYqclfsMkBzHaS3IsXKMb2zEc/O6Ywo3smHc445Rplu5lXv4pA7+YvBAoGBAI/4
tXxlMfkbbiBpScFTAIWZ2C32ir3/ZUIthNFC1Nnq6rodqayNfBNMqqhygmD+9e80
J3FdlLgxhttpc+E0R6tq+VUcHbXEhis5n9hLUxvFuzpRIy10HwiAirIJ2KQmLGvu
6MQgmRrRP6JQMfQugRhZfd2z7j2GQs5nCrdC1N3hAoGALXruDquYWMpMwW+88iQT
TqXZrmiv33fYL3IxWWwVpGrt88BFknJ2RU/ozr+XNAc425yZh08a8MuAF26VIMOu
UIcvaVAvjnjiuTF5WKX3GD7QOTYbFuWg/eAKJJbIy0y35BcEXqsv1MIZQ0kRbetG
09r5nSJj9HHiYVK7GGA45tI=
-----END PRIVATE KEY-----
`.trim();

const PUBLIC_PEM_INLINE = `
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxLQ5LK44E5Wyl1/rHilw
fJojvGLeYuwJCQIV2p6DPJuIk5n5XhHcj0LCETaAcbypbg0T2uFWCvugNK6Fm2kB
NVXif3DUCuaJ7TxvDPY4lARhWYnRYrlzlSzjSQeodqWsZcz6vU6cwsDPNV7ocwhv
EUMmE0+CkT1uFA/XNioa240pLPLMe0rwhxRXBYdi38q+yeBhrSr0lfbdg6n0FoZ/
83MzzAYLZTXJ56kJF7rKL06R0CRSKe0ZffptxSykI0ttL2yY+UvnI7mA4Ub69cm0
wR0nxbCU8SWyUWWny+EddH4+FoBTMghOXPPSvi7utSX2wHdSyOQjhk6nDh50qrk+
LQIDAQAB
-----END PUBLIC KEY-----
`.trim();

// Use file if present, otherwise inline
const DC_PRIVATE_KEY_PEM = PRIVATE_PEM_FROM_FILE || PRIVATE_PEM_INLINE;
const DC_PUBLIC_KEY_PEM = PUBLIC_PEM_FROM_FILE || PUBLIC_PEM_INLINE;

export const env = {
    /* server */
    port: 5000,
    nodeEnv: 'development',
    APP_URL: 'https://auth.magneticbyteinternettechnologiesopcpvtltd.in',
    FRONTEND_ORIGIN: 'http://localhost:3000',

    /* db/auth */
    mongoUri: 'mongodb+srv://meshouryanarwade:Shourya%402007@cluster0.b6z4nz9.mongodb.net/bsuite',
    accessSecret: 'aksjdhaksjSHouryaakjdhsadkjahsdkjhasd',
    refreshSecret: 'aksjdhaksjReplavascekjdhsadkjahsdkjhasd',
    accessTtl: '30m',
    refreshTtl: '30d',

    /* cors/cookies */
    corsOrigins: ['http://localhost:3000'],
    cookieSecure: false,

    /* facebook/wa (optional) */
    FB_APP_ID: '737215622456564',
    FB_APP_SECRET: '1ddcb93a22b50b47aec8378434205606',
    FB_REDIRECT_URI: 'http://localhost:5000/api/wa/embedded_signup/callback',
    FB_APP_ACCESS_TOKEN: 'YOUR_LONG_LIVED_APP_OR_SYSTEM_USER_TOKEN',
    WA_WEBHOOK_VERIFY_TOKEN: 'aksjdhaksjwebhokasdokasdokavascekjdhsadkjahsdkjhasd',

    /* smtp */
    SMTP_HOST: 'smtp.hostinger.com',
    SMTP_PORT: 465,
    SMTP_USER: 'accountservices@magneticbyte.com',
    SMTP_PASS: 'vZ6!yC0y5#4',                  // don’t commit real secrets
    MAIL_FROM: 'accountservices@magneticbyte.com',

    /* domain connect + email auth */
    DC_PRIVATE_KEY_PEM,                       // full block with BEGIN/END
    DC_PUBLIC_KEY_PEM,                        // full block with BEGIN/END
    DC_PROVIDER_ID: 'magneticbyteinternettechnologiesopcpvtltd.in',
    DC_SERVICE_ID: 'email-auth',
    DC_KEY_HOST: 'key1',
    DC_REDIRECT_URI: 'https://auth.magneticbyteinternettechnologiesopcpvtltd.in/api/domainconnect/callback.html',
    DKIM_TARGET_BASE: 'domainkey.magneticbyteinternettechnologiesopcpvtltd.in',
    DNS_TTL: 3600,
    DKIM_SELECTOR1: 'k3',
    DKIM_SELECTOR2: 'k4',
    SVC_DOMAIN: 'your-svc.net',
    DMARC_RUA: 'mailto:dmarc@yourco.example',

    MAIL_RUNNER_INTERVAL_MS:2000,
    MAIL_RUNNER_CONCURRENCY:3,
    MAIL_RUNNER_LOCK_MS:60000,
    MAIL_MAX_ATTEMPTS:5,
    MAIL_BACKOFF_BASE_MS:15000,
    MAIL_BACKOFF_MAX_MS:1800000,
    INSTANCE_ID:"api-1",
    TRACKING_SECRET: "superlongrandomhmacsecret",
};

// Friendly sanity checks (won’t crash)
if (!env.DC_PRIVATE_KEY_PEM.includes('BEGIN PRIVATE KEY')) {
    console.warn('[env] DC private key is not loaded. Domain Connect signatures will be disabled.');
}
if (!env.DC_PUBLIC_KEY_PEM.includes('BEGIN PUBLIC KEY')) {
    console.warn('[env] DC public key is not loaded (DNS public-key publishing tests may fail).');
}
